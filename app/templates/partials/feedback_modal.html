<button
  id="feedback-btn"
  class="fixed bottom-6 right-6 z-40 bg-white p-3 rounded-full shadow-lg border border-purple-100 text-purple-600 hover:scale-110 transition-transform group"
  title="意见反馈"
>
  <span class="text-2xl group-hover:animate-spin-slow">💬</span>
</button>

<div
  id="feedback-modal"
  class="fixed inset-0 z-50 hidden flex items-center justify-center bg-gray-900/40 backdrop-blur-sm opacity-0 transition-opacity duration-300"
>
  <div
    class="bg-white rounded-2xl shadow-2xl p-6 w-[90%] max-w-md transform scale-95 transition-transform duration-300"
    id="feedback-card"
  >
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-xl font-bold text-gray-800">您觉得这个测试准吗？</h3>
      <button id="close-feedback" class="text-gray-400 hover:text-gray-600 text-2xl">&times;</button>
    </div>

    <div class="flex justify-center gap-2 mb-6" id="star-container">
      <button data-val="1" class="star-btn text-3xl text-gray-300 hover:text-yellow-400 transition-colors">★</button>
      <button data-val="2" class="star-btn text-3xl text-gray-300 hover:text-yellow-400 transition-colors">★</button>
      <button data-val="3" class="star-btn text-3xl text-gray-300 hover:text-yellow-400 transition-colors">★</button>
      <button data-val="4" class="star-btn text-3xl text-gray-300 hover:text-yellow-400 transition-colors">★</button>
      <button data-val="5" class="star-btn text-3xl text-gray-300 hover:text-yellow-400 transition-colors">★</button>
    </div>

    <div class="mb-4">
      <label class="block text-xs font-bold text-gray-400 uppercase tracking-wider mb-2">本次测试结果</label>
      <div class="relative">
        <select id="feedback-mbti-select" class="w-full p-3 bg-gray-50 border border-gray-200 rounded-xl appearance-none text-gray-700 font-bold focus:ring-2 focus:ring-purple-500 outline-none transition-all">
          <option value="Unknown">-- 未自动识别 (请选择) --</option>
          <option value="INTJ">INTJ (建筑师)</option>
          <option value="INTP">INTP (逻辑学家)</option>
          <option value="ENTJ">ENTJ (指挥官)</option>
          <option value="ENTP">ENTP (辩论家)</option>
          <option value="INFJ">INFJ (提倡者)</option>
          <option value="INFP">INFP (调停者)</option>
          <option value="ENFJ">ENFJ (主人公)</option>
          <option value="ENFP">ENFP (竞选者)</option>
          <option value="ISTJ">ISTJ (物流师)</option>
          <option value="ISFJ">ISFJ (守卫者)</option>
          <option value="ESTJ">ESTJ (总经理)</option>
          <option value="ESFJ">ESFJ (执政官)</option>
          <option value="ISTP">ISTP (鉴赏家)</option>
          <option value="ISFP">ISFP (探险家)</option>
          <option value="ESTP">ESTP (企业家)</option>
          <option value="ESFP">ESFP (表演者)</option>
        </select>
        <div class="absolute inset-y-0 right-0 flex items-center px-3 pointer-events-none text-gray-400">
          ▼
        </div>
      </div>
    </div>

    <textarea
      id="feedback-content"
      rows="3"
      placeholder="(选填) 告诉我们需要改进的地方..."
      class="w-full p-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent outline-none text-sm mb-4"
    ></textarea>

    <input type="hidden" id="server-mbti-type" value="{{ request.query_params.get('type', '') }}" />

    <button
      id="submit-feedback-btn"
      class="w-full py-3 rounded-xl font-bold text-white bg-gradient-to-r from-purple-600 to-pink-600 shadow-md hover:shadow-lg hover:opacity-90 transition-all"
    >
      提交反馈
    </button>
  </div>
</div>
